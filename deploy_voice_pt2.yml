---
- name: Inicia Deploy Gateway
  hosts: "{{ host_voice }}"
  become: yes
  gather_facts: yes
  handlers:
    - name: Log Message
      shell: echo "\033[32m####_ADICIONANDO_USUARIO_AO_GRUPO_DOCKER####\033[0m" >> /var/log/ansible_deploy_logs/deploy_log.txt 2>&1

  tasks:
    - name: Log Message Iniciando deploy
      notify: Log Message

    - name: Adiciona o usuÃ¡rio ao grupo Docker
      user:
        name: "{{ ansible_user }}"
        groups: docker
        append: yes
      become: yes
      notify: Log Message

    - name: Espera 1 segundo
      pause:
        seconds: 1
      notify: Log Message

    - name: Log Message Iniciando update de pacotes
      shell: echo "\033[32m####_UPDATE_PACOTES####\033[0m" >> /var/log/ansible_deploy_logs/deploy_log.txt 2>&1
      notify: Log Message

    - name: Executa o comando apt-get update
      command: apt-get update -y > /var/log/ansible_deploy_logs/deploy_log.txt
      register: update_result
